<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Temporary Notepad</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#0b1220; --muted:#5b6470; --accent:#3b82f6;
    }
    [data-theme="dark"]{ --bg:#0b1220; --card:#0f1724; --text:#e6eef8; --muted:#9aa6b2; --accent:#60a5fa }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,system-ui,-apple-system,Segoe UI Emoji,Arial;background:var(--bg);color:var(--text)}
    .wrap{max-width:900px;margin:28px auto;padding:20px}
    .card{background:var(--card);border-radius:14px;box-shadow:0 6px 20px rgba(11,18,32,0.07);padding:18px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:18px}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:transparent;border:1px solid #e6eef8;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--accent);color:white;border:0}
    .btn.ghost{background:transparent;border:1px dashed rgba(0,0,0,0.06)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:100%;min-height:52vh;border:0;padding:16px;border-radius:8px;font-size:15px;resize:vertical;background:transparent;color:var(--text);outline:none}
    .meta{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:10px;color:var(--muted);font-size:13px}
    .small{font-size:12px;color:var(--muted)}
    .pill{background:rgba(0,0,0,0.04);padding:6px 10px;border-radius:999px;font-weight:600}
    .danger{color:#ef4444}
    @media (max-width:640px){.wrap{margin:10px;padding:12px}.card{padding:12px}textarea{min-height:48vh}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div style="display:flex;flex-direction:column">
          <h1>Temporary Notepad</h1>
          <div class="small">Autosaves to your browser. Expires after <span id="expiry-days">7</span> days.</div>
        </div>
        <div class="controls">
          <button class="btn" id="toggle-theme" title="Toggle theme">Toggle theme</button>
          <button class="btn" id="clear-note" title="Clear note">Clear</button>
          <button class="btn" id="download" title="Download note">Download</button>
          <button class="btn primary" id="new-note" title="Create new note">New</button>
        </div>
      </header>

      <div class="toolbar" style="margin-top:14px">
        <div class="pill" id="status">Unsaved</div>
        <div class="small">Last saved: <span id="last-saved">—</span></div>
        <div class="small">Words: <strong id="word-count">0</strong></div>
        <div class="small">Chars: <strong id="char-count">0</strong></div>
      </div>

      <main style="margin-top:12px">
        <textarea id="editor" placeholder="Write something temporary..."></textarea>
      </main>

      <div class="meta">
        <div class="small">Storage key: <code id="storage-key">temp-notepad</code></div>
        <div class="small">Auto-save: <span id="autosave-interval">2s</span></div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const KEY = 'temp-notepad-v1';
      const EXPIRY_DAYS = 7; // change if you want longer/shorter
      document.getElementById('storage-key').textContent = KEY;
      document.getElementById('expiry-days').textContent = EXPIRY_DAYS;

      const editor = document.getElementById('editor');
      const status = document.getElementById('status');
      const lastSaved = document.getElementById('last-saved');
      const wordCount = document.getElementById('word-count');
      const charCount = document.getElementById('char-count');
      const autosaveIntervalLabel = document.getElementById('autosave-interval');

      let saveTimer = null;
      let dirty = false;

      function nowISO(){ return new Date().toISOString(); }
      function niceDate(iso){ if(!iso) return '—'; const d=new Date(iso); return d.toLocaleString(); }

      function load(){
        try{
          const raw = localStorage.getItem(KEY);
          if(!raw) return;
          const obj = JSON.parse(raw);
          if(!obj || typeof obj !== 'object') return;
          if(obj.savedAt){
            const saved = new Date(obj.savedAt);
            const ageDays = (Date.now() - saved.getTime()) / (1000*60*60*24);
            if(ageDays > EXPIRY_DAYS){
              // expired: keep content in memory but remove from localStorage so it feels temporary
              status.textContent = 'Expired — loaded as read-only';
              status.classList.add('danger');
              editor.value = obj.text || '';
              editor.setAttribute('disabled','');
              lastSaved.textContent = niceDate(obj.savedAt);
              updateCounts();
              return;
            }
          }
          editor.value = obj.text || '';
          lastSaved.textContent = niceDate(obj.savedAt);
          status.textContent = 'Loaded';
          updateCounts();
        }catch(e){ console.warn('Could not load note', e); }
      }

      function save(){
        try{
          const payload = { text: editor.value, savedAt: nowISO() };
          localStorage.setItem(KEY, JSON.stringify(payload));
          status.textContent = 'All changes saved';
          status.classList.remove('danger');
          lastSaved.textContent = niceDate(payload.savedAt);
          dirty = false;
        }catch(e){ console.error('Save failed', e); status.textContent = 'Save failed'; }
      }

      function updateCounts(){
        const txt = editor.value || '';
        const chars = txt.length;
        const words = txt.trim().length ? txt.trim().split(/\s+/).length : 0;
        charCount.textContent = chars;
        wordCount.textContent = words;
      }

      // Auto-save with debounce
      editor.addEventListener('input', ()=>{
        dirty = true;
        status.textContent = 'Unsaved';
        if(saveTimer) clearTimeout(saveTimer);
        updateCounts();
        saveTimer = setTimeout(()=>{ save(); }, 1400);
      });

      // Buttons
      document.getElementById('download').addEventListener('click', ()=>{
        const content = editor.value || '';
        const filename = 'note-' + new Date().toISOString().slice(0,19).replace(/[:T]/g,'-') + '.txt';
        const blob = new Blob([content], {type:'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
      });

      document.getElementById('clear-note').addEventListener('click', ()=>{
        if(!confirm('Clear note from editor? This will NOT delete saved copy in browser.')) return;
        editor.value = '';
        updateCounts();
        status.textContent = 'Unsaved';
      });

      document.getElementById('new-note').addEventListener('click', ()=>{
        if(!confirm('Create a new note? This will clear the editor and overwrite saved note when you save.')) return;
        editor.value = '';
        updateCounts();
        save();
      });

      // Theme toggle (persisted in localStorage)
      const themeKey = 'temp-notepad-theme';
      const root = document.documentElement;
      function applyTheme(t){ if(t==='dark') root.setAttribute('data-theme','dark'); else root.removeAttribute('data-theme'); localStorage.setItem(themeKey,t); }
      document.getElementById('toggle-theme').addEventListener('click', ()=>{
        const current = localStorage.getItem(themeKey) || 'light';
        applyTheme(current === 'dark' ? 'light' : 'dark');
      });
      // initialize theme
      applyTheme(localStorage.getItem(themeKey) || (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light'));

      // On load
      load();

      // Before unload prompt when dirty
      window.addEventListener('beforeunload', (e)=>{
        if(!dirty) return;
        e.preventDefault();
        e.returnValue = '';
      });

      // Quick shortcut: Ctrl/Cmd+S to save
      window.addEventListener('keydown', (e)=>{
        if((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 's'){
          e.preventDefault(); save();
        }
      });

      // Expose small API on window for advanced users
      window.TempNotepad = { save, load, clearStorage: ()=>{ localStorage.removeItem(KEY); lastSaved.textContent='—'; status.textContent='Storage cleared'; } };

      // Initial counts
      updateCounts();

      // Optional: housekeeping - remove very old backups (30 days) to avoid localStorage bloat
      try{
        const raw = localStorage.getItem(KEY);
        if(raw){
          const obj = JSON.parse(raw);
          if(obj && obj.savedAt){
            const ageDays = (Date.now() - new Date(obj.savedAt).getTime())/(1000*60*60*24);
            if(ageDays > 30) localStorage.removeItem(KEY);
          }
        }
      }catch(e){}

    })();
  </script>
</body>
</html>
